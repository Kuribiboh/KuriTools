param (
    [string]$BasePath = $PSScriptRoot # fallback if run manually
)

# Malwarebytes Support Tool
$downloadUrl = "https://downloads.malwarebytes.com/file/mbst"
$targetDir = "$BasePath\Tools\Windows\MalwarebytesSupportTool"
$workingDir = "$BasePath\Tools\Temp"
$exeName = "mb-support-tool.exe"
$tempPattern = "$workingDir\mb-support*"

# Ensure working and target directories exist
New-Item -ItemType Directory -Force -Path $workingDir | Out-Null
New-Item -ItemType Directory -Force -Path $targetDir | Out-Null

# Download the EXE file to temp (random name will be saved)
Invoke-WebRequest -Uri $downloadUrl -OutFile "$workingDir\temp_download.exe"

# Find the actual filename (since it's versioned)
$downloadedExe = Get-ChildItem "$workingDir\temp_download.exe"

# Rename and move it
Move-Item -Path $downloadedExe.FullName -Destination "$targetDir\$exeName" -Force

Write-Host "Malwarebytes Support Tool downloaded to: $targetDir\$exeName"
